<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tourare | Custom Admin</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700&family=Inter:wght@400;600&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; background: #F9FAFB; }
        .serif { font-family: 'Playfair Display', serif; }
        .glass { background: rgba(255, 255, 255, 0.8); backdrop-filter: blur(12px); }
    </style>
</head>
<body class="p-8">
    <div class="max-w-4xl mx-auto">
        <header class="flex justify-between items-center mb-12">
            <h1 class="serif text-3xl">Tourare Admin Panel</h1>
            <div id="auth-status" class="text-xs font-bold tracking-widest uppercase text-slate-400">Status: Terkunci</div>
        </header>

        <!-- Auth Section -->
        <div id="auth-form" class="glass p-8 rounded-xl shadow-sm border border-slate-100 mb-8">
            <h2 class="font-bold mb-4">Akses GitHub</h2>
            <p class="text-sm text-slate-500 mb-6">Masukkan GitHub Personal Access Token kamu untuk mulai mengedit.</p>
            <div class="flex gap-4">
                <input type="password" id="gh-token" placeholder="ghp_xxxxxxxxxxxx" class="flex-1 border border-slate-200 rounded-lg px-4 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-emerald-500">
                <button onclick="login()" class="bg-emerald-600 text-white px-6 py-2 rounded-lg text-sm font-bold hover:bg-emerald-700 transition-all">Hubungkan</button>
            </div>
            <p class="mt-4 text-[10px] text-slate-400">Token disimpan lokal di browser kamu (LocalStorage).</p>
        </div>

        <!-- CMS Content Section (Hidden by default) -->
        <div id="cms-content" class="hidden space-y-8">
            <!-- Hero Edit -->
            <div class="glass p-8 rounded-xl shadow-sm border border-slate-100">
                <h2 class="serif text-xl mb-6">Edit Bagian Hero</h2>
                <div class="space-y-4">
                    <div>
                        <label class="block text-[10px] font-bold uppercase tracking-widest text-slate-400 mb-2">Judul Utama</label>
                        <input type="text" id="edit-hero-title" class="w-full border border-slate-200 rounded-lg px-4 py-2 text-sm">
                    </div>
                    <div>
                        <label class="block text-[10px] font-bold uppercase tracking-widest text-slate-400 mb-2">Deskripsi</label>
                        <textarea id="edit-hero-desc" rows="3" class="w-full border border-slate-200 rounded-lg px-4 py-2 text-sm"></textarea>
                    </div>
                    <button onclick="saveHero()" class="bg-slate-900 text-white px-6 py-2 rounded-lg text-sm font-bold hover:bg-black transition-all">Simpan Perubahan Hero</button>
                </div>
            </div>

            <!-- Destinations Edit -->
            <div class="glass p-8 rounded-xl shadow-sm border border-slate-100">
                <h2 class="serif text-xl mb-6">Edit Destinasi</h2>
                <div id="destinations-list" class="space-y-6">
                    <!-- Dinamis via JS -->
                    <p class="text-sm text-slate-400 italic">Mengambil data destinasi...</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        let GH_TOKEN = localStorage.getItem('tourare_gh_token');
        const REPO = "ramdotcode/tourare"; // Ganti dengan repo kamu

        async function login() {
            const token = document.getElementById('gh-token').value;
            if(!token) return alert('Masukkan token!');
            localStorage.setItem('tourare_gh_token', token);
            location.reload();
        }

        if(GH_TOKEN) {
            document.getElementById('auth-form').classList.add('hidden');
            document.getElementById('cms-content').classList.remove('hidden');
            document.getElementById('auth-status').innerText = "Status: Terhubung";
            document.getElementById('auth-status').classList.replace('text-slate-400', 'text-emerald-500');
            initCMS();
        }

        async function initCMS() {
            // Load Hero
            const heroData = await fetchFile('data/hero.json');
            document.getElementById('edit-hero-title').value = heroData.content.title;
            document.getElementById('edit-hero-desc').value = heroData.content.description;

            // Load Destinations
            const dests = ['kyoto.json', 'alentejo.json', 'dolomites.json'];
            const list = document.getElementById('destinations-list');
            list.innerHTML = '';
            
            for(let file of dests) {
                const data = await fetchFile(`data/destinations/${file}`);
                const div = document.createElement('div');
                div.className = "p-4 border border-slate-100 rounded-lg bg-slate-50/50";
                div.innerHTML = `
                    <div class="flex justify-between items-center mb-4">
                        <span class="font-bold text-sm">${data.content.title}</span>
                        <span class="text-[10px] text-slate-400">${file}</span>
                    </div>
                    <div class="grid grid-cols-2 gap-4">
                        <input type="text" value="${data.content.price}" id="price-${file}" class="border border-slate-200 rounded px-3 py-1 text-xs">
                        <button onclick="saveDest('${file}', '${data.sha}')" class="bg-white border border-slate-200 text-xs font-bold py-1 rounded hover:bg-slate-100">Update Harga</button>
                    </div>
                `;
                list.appendChild(div);
            }
        }

        async function fetchFile(path) {
            const res = await fetch(`https://api.github.com/repos/${REPO}/contents/${path}`, {
                headers: { 'Authorization': `token ${GH_TOKEN}` }
            });
            const json = await res.json();
            return {
                content: JSON.parse(atob(json.content)),
                sha: json.sha
            };
        }

        async function saveHero() {
            const current = await fetchFile('data/hero.json');
            const newData = {
                ...current.content,
                title: document.getElementById('edit-hero-title').value,
                description: document.getElementById('edit-hero-desc').value
            };
            await updateGitHub('data/hero.json', newData, current.sha, "Update Hero via Custom CMS");
            alert('Hero berhasil diupdate! Tunggu 1 menit untuk lihat perubahan di web.');
        }

        async function saveDest(file, sha) {
            const current = await fetchFile(`data/destinations/${file}`);
            const newData = {
                ...current.content,
                price: document.getElementById(`price-${file}`).value
            };
            await updateGitHub(`data/destinations/${file}`, newData, current.sha, `Update price for ${file}`);
            alert(`${file} updated!`);
        }

        async function updateGitHub(path, content, sha, message) {
            const res = await fetch(`https://api.github.com/repos/${REPO}/contents/${path}`, {
                method: 'PUT',
                headers: { 
                    'Authorization': `token ${GH_TOKEN}`,
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    message: message,
                    content: btoa(JSON.stringify(content, null, 2)),
                    sha: sha
                })
            });
            return res.json();
        }
    </script>
</body>
</html>
